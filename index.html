<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Nunito&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Two+Tone|Material+Icons+Round|Material+Icons+Sharp" rel="stylesheet">
    <style>
        html,
        body {
            height: 100%;
            padding: 0;
            margin: 0;
            height: 100%;
            font-family: Verdana, Geneva, Lucida, Arial, Helvetica, Lucida Console, Monaco, monospace;
            font-size: 100%;
        }
        
        #map {
            position: absolute;
            height: 100%;
            width: 100%;
        }
        
        .leaflet-tooltip.my-labels {
            font-family: 'Nunito', sans-serif;
            background-color: transparent;
            box-shadow: none;
            font-weight: bold;
            font-size: 20px;
            text-shadow: 2px 2px 2px #160303;
            white-space: normal;
            text-align: center;
            line-height: 120%;
            border: none;
            width: 200px;
            border-width: 2px;
            color: #fafafa;
        }
    </style>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>


</head>

<body>
    <p><img src="images/love.gif"></p>
    <div id="map"></div>

</body>
<script>
    var map = L.map('map').setView([39.40748359101977, -9.131741523742676], 13);
    L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
        maxZoom: 18,
        minZoom: 11,
        id: 'mapbox/streets-v11',
        tileSize: 512,
        zoomOffset: -1,
        accessToken: 'pk.eyJ1IjoibWFwYXVyYmFubyIsImEiOiJja215cm8xYzIwNHp1Mnh0M2QwZ3puZmkwIn0.ig4jIr-gZzUfuIX8YZB0ug'
    }).addTo(map);

    const url = "data/geral.geojson"
    const detail = "data/detail.geojson"
        //const url = "https://dadosabertos.cascais.pt/dataset/747d02ae-21fb-4fa3-8a07-9da8db991684/resource/8ded093a-7978-4062-8d64-7598db2f8506/download/mnpraia.geojson"
    var myHeaders = new Headers();

    var inicio = new Date()
    console.log(inicio)
        ////// POPUP/////

    function onEachFeature(feature, layer) {
        var popupContent = "<p>I started out as a GeoJSON " +
            feature.geometry.type + ", but now I'm a Leaflet vector!</p>";

        if (feature.properties && feature.properties.Name) {
            popupContent += feature.properties.Name + '<br>'

        }

        layer.bindPopup(popupContent);
    }
    //////LABEL TEXT//////

    function labelText(feature, latlng) {
        var size = feature.properties.Size ? feature.properties.Size : '20'
        var radius = size ? size * 2.3 : 100


        label = String('<span " style=" font-size: ' + size + 'px;">' + feature.properties.Name + '</span>') // .bindTooltip can't use straight 'feature.properties.attribute'
        return new L.CircleMarker(latlng, {
            radius: radius,
        }).bindTooltip(label, {
            permanent: true,
            direction: "center",
            className: "my-labels"
        }).openTooltip();
    }

    //// function text marker zoom////
    function textZoom(pointLayer, zoom) {
        var zoomlevel = map.getZoom();
        if (zoomlevel < zoom) {
            if (map.hasLayer(pointLayer)) {
                map.removeLayer(pointLayer);
            } else {
                console.log("no point layer active");
            }
        }
        if (zoomlevel >= zoom) {
            if (map.hasLayer(pointLayer)) {
                console.log("layer already added");
            } else {
                map.addLayer(pointLayer);
            }
        }
        console.log("Current Zoom Level =" + zoomlevel)

    };

    function labelText(feature, latlng) {
        var size = feature.properties.Size ? feature.properties.Size : '20'
        var radius = size ? size * 2.3 : 100
        var l
        switch (feature.properties.Love) {
            case 'love':
                l = '<p><img src="images/love.gif"></p>';
                break;
            case 'hot':
                l = '<p><img src="images/hot.gif"></p>';
                break;
            case 'bad':
                l = '<p><img src="images/bad.gif"></p>';
                break;
            case 'mort':
                l = '<p><img src="images/mort.gif"></p>';
                break;
            case 'pff':
                l = '<p><img src="images/pff.gif"></p>';
                break;
            case 'religion':
                l = '<p><img src="images/religion.gif"></p>';
                break;
            case 'sardines':
                l = '<p><img src="images/sardines.gif"></p>';
                break;
            case 'tourist':
                l = '<p><img src="images/tourist.gif"></p>';
                break;
            case 'surprise':
                l = '<p><img src="images/surprise.gif"></p>';
                break;
            case 'desert':
                l = '<p><img src="images/desert.gif"></p>';
                break;
            case 'surfing':
                l = '<p><img src="images/surfing.gif"></p>';
                break;
            case 'paisagem':
                l = '<p><img src="images/paisagem.gif"></p>';
                break;
            default:
                l = '';

        }
        console.log(feature.properties.love + '--' + l)

        label = String(l + '<span " style=" font-size: ' + size + 'px;">' + feature.properties.Name + '</span>') // .bindTooltip can't use straight 'feature.properties.attribute'
        return new L.CircleMarker(latlng, {
            radius: radius,
        }).bindTooltip(label, {
            permanent: true,
            direction: "center",
            className: "my-labels"
        }).openTooltip();
    }

    //// function text marker zoom////
    function textZoomDetail(pointLayer, zoom) {
        var zoomlevel = map.getZoom();
        map.addLayer(pointLayer)
        if (zoomlevel < zoom) {
            if (map.hasLayer(pointLayer)) {
                map.removeLayer(pointLayer);
            } else {
                console.log("no point layer active");
            }
        }
        if (zoomlevel >= zoom) {
            if (map.hasLayer(pointLayer)) {
                console.log("layer already added");
            } else {
                map.addLayer(pointLayer);
            }
        }
        console.log("Current Zoom Level =" + zoomlevel)

    };


    function getText(url, detail, zoom = false) {

        fetch(detail)
            .then((response) => {
                return response.json();
            })
            .then((data) => {
                console.log(data.features)


                var detail = L.geoJSON(data, {

                    style: (feature) => {
                        return {
                            color: feature.properties.Color,
                            opacity: 0,
                            //dashArray: 20,
                            // fill: false
                        };
                    },

                    onEachFeature: onEachFeature,

                    pointToLayer: labelText

                });


                /////add remove layer zoom///

                map.on('zoomend', () => textZoom(detail, zoom))
                    // map.fitBounds(pointLayer.getBounds());
            });
        //////

        fetch(url)
            .then((response) => {
                return response.json();
            })
            .then((data) => {
                console.log(data.features)


                var geral = L.geoJSON(data, {

                    style: (feature) => {
                        return {
                            color: feature.properties.Color,
                            opacity: 0,
                            //dashArray: 20,
                            // fill: false
                        };
                    },

                    onEachFeature: onEachFeature,

                    pointToLayer: labelText

                });
                geral.addData(data)
                map.addLayer(geral)
                    /////add remove layer zoom///


            });


    }
    window.load = getText(url, detail, 15)
</script>


</html>